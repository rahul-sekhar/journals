%h2 {{pageTitle}}

%section#upper-bar
  .people-fields{ "ng-hide" => "singlePerson" }
    %input#search{ "placeholder"=>"Enter search term", "name"=>"search", "ng-model"=>"search", "on-type"=>"doSearch(search)", "autocomplete"=>"off"}

    .add.menu
      %a.title{ href: "" } Add
      
      %ul
        %li
          %a{ "href"=>"", "ng-show"=>"pageData.canAddTeacher", "ng-click"=>"addTeacher()" } Add teacher
        %li
          %a{ "href"=>"", "ng-show"=>"pageData.canAddStudent" } Add student
        %li
          %a{ "href"=>"", "ng-click"=>"manageGroups=true" } Manage groups

    %p.label Viewing

    .viewing.menu
      %a.title{ href: "" } {{pageData.filter}}

      %ul
        %li{"ng-hide" => "pageData.filter == 'Students and teachers'"}
          %a{href: "/people"} Students and teachers
        %li{"ng-hide" => "pageData.filter == 'Students'"}
          %a{href: "/students"} Students
        %li{"ng-hide" => "pageData.filter == 'Teachers'"}
          %a{href: "/teachers"} Teachers
        %li{"ng-hide" => "(pageData.filter == 'Your mentees') || (!isTeacher)"}
          %a{href: "/mentees"} Your mentees
        %li{"ng-hide" => "pageData.filter == 'Archived students and teachers'"}
          %a{href: "/people/archived"} Archived students and teachers

        %li.divider{"ng-show"=>"groups.length"}
        %li{"ng-repeat"=>"group in groups", "ng-hide"=>"pageData.filter == group.name"}
          %a{"ng-href" => "/groups/{{group.id}}"} {{group.name}}

  .clear-left

%article.profile{ "ng-repeat"=>"person in people", "ng-hide"=>"person.deleted" }
  %header.profile-header
    %h3{ "edit-in-place"=>"person.update('full_name', value)", "editor-attr"=>"person.full_name",
      "display"=>"{{person.full_name}}", "edit-mode"=>"person.editing['full_name']" }

    %p.type{ "ng-show"=>"person.type == 'Teacher'" }
      {{person.type}}

    .manage.menu
      .icon.title
      %ul
        %li{ "ng-hide"=>"person.archived || !person.email" }
          %a{ "href"=>"", "ng-click"=>"person.resetPassword()" } {{person.active && "Reset password" || "Activate"}}
        %li
          %a{ "href"=>"", "ng-click"=>"person.toggleArchive()" } {{person.archived && "Unarchive" || "Archive"}}
        %li
          %a{ "href"=>"", "ng-click"=>"delete(person)" } Delete

    .clear-left

  %profile-fields.main-profile-fields{ "parent"=>"person" }

  .guardians{ "ng-show"=>"person.type == 'Student'" }
    .guardian{ "ng-repeat"=>"guardian in person.guardians", "ng-hide"=>"guardian.deleted" }
      
      %header.guardian-header
        %h4{ "edit-in-place"=>"guardian.update('full_name', value)", "editor-attr"=>"guardian.full_name",
          "display"=>"{{guardian.full_name}}", "edit-mode"=>"guardian.editing['full_name']"}

        .manage.menu
          .icon.title
          %ul
            %li{ "ng-hide"=>"guardian.archived || !guardian.email" }
              %a{ "href"=>"", "ng-click"=>"guardian.resetPassword()" } {{guardian.active && "Reset password" || "Activate"}}
            %li
              %a{ "href"=>"", "ng-click"=>"person.removeGuardian(guardian)" } 
                {{(guardian.number_of_students > 1) && "Remove" || "Delete"}}
        
        .clear-left

      %profile-fields.guardian-profile-fields{ "parent"=>"guardian" }

  %footer.profile-footer
    .groups{ "ng-show"=>"person.type == 'Student'" }
      %h4 Groups
      %ul.existing
        %li{ "ng-repeat"=>"group in person.groups", "ng-hide"=>"group.deleted" }
          %span {{group.name}}
          %a.remove{ "href"=>"", "ng-click"=>"person.removeGroup(group)" } Remove
        %li{ "ng-hide"=>"person.groups.length" }
          None

      %filtered-list{ "list"=>"person.remainingGroups()", "show-property"=>"name", "on-select"=>"person.addGroup(value)" }

    .mentors{ "ng-show"=>"person.type == 'Student'" }
      %h4 {{person.mentors.length > 1 && 'Mentors' || 'Mentor'}}
      %ul.existing
        %li{ "ng-repeat"=>"mentor in person.mentors", "ng-hide"=>"mentor.deleted" }
          %span {{mentor.name}}
          %a.remove{ "href"=>"", "ng-click"=>"person.removeMentor(mentor)" } Remove
        %li{ "ng-hide"=>"person.mentors.length" }
          None

      %filtered-list{ "list"=>"person.remainingMentors()", "show-property"=>"name", "on-select"=>"person.addMentor(value)" }

    .mentees{ "ng-show"=>"person.type == 'Teacher'" }
      %h4 {{person.mentees.length > 1 && 'Mentees' || 'Mentee'}}
      %ul.existing
        %li{ "ng-repeat"=>"mentee in person.mentees", "ng-hide"=>"mentee.deleted" }
          %span {{mentee.name}}
          %a.remove{ "href"=>"", "ng-click"=>"person.removeMentee(mentee)" } Remove
        %li{ "ng-hide"=>"person.mentees.length" }
          None

      %filtered-list{ "list"=>"person.remainingMentees()", "show-property"=>"name", "on-select"=>"person.addMentee(value)" }

.content-block{ "ng-hide"=>"people.length" }
  %p No matching people were found.

%pagination{ "total-pages"=>"totalPages", "current-page"=>"currentPage" }

%modal{ "show-on"=>"manageGroups" }
  #groups{ "ng-controller"=>"GroupsCtrl" }
    %h3 Manage groups
    %ul{ "ng-show"=>"groups.length" }
      %li{ "ng-repeat"=>"group in groups", "ng-hide"=>"group.deleted" }
        %p{ "edit-in-place"=>"group.updateField('name', value)", "editor-attr"=>"group.name", "display"=>"{{group.name}}",
          "edit-mode"=>"group.editing.name" }
        %a.delete{ "href"=>"", "ng-click"=>"group.delete()", "ng-show"=>"group.id" } Delete
    %p{ "ng-hide"=>"groups.length" }
      There are no groups yet.
    %a.add{ "href"=>"", "ng-click"=>"add()" } Add group





/ %header.profile-header
/   %h3= profile.full_name
/   - if profile.is_a? Teacher
/     %p.type Teacher
    

/   !!
/   - if can? :administrate, profile
/     = render 'shared/profile/administrate_menu', profile: profile
/   !!

/   .clear-left

/ .main-profile-fields
/   - profile.class.fields.each do |field|
/     = render 'shared/profile/field', field_data: field, field_value: profile.send(field[:function])

/   - if can? :update, profile
/     .edit
/       = link_to "Edit profile", edit_profile_path(profile), class: 'edit-link'


/ - if profile.is_a? Student
/   .guardians
/     !!
/     - if can? :create, Guardian
/       = link_to "Add guardian", new_student_guardian_path(profile), class: "add-guardian"
/     !!

/     - profile.guardians.each do |guardian|
/       = render "shared/profile/guardian", guardian: guardian, student: profile

/ !!
/ %footer.profile-footer
/   - if profile.is_a? Student
/     .groups
/       = render "shared/profile/groups", student: profile

/     .mentors
/       = render "shared/profile/mentors", student: profile

/   - if profile.is_a? Teacher
/     .mentees
/       = render "shared/profile/mentees", teacher: profile
/ !!